## 融合光流法和深度学习模型的卫星云图预测

> 卫星云图预测是遥感和图像视觉交叉领域中出现的一个应用**问题**，旨在根据观测时刻历史资料生成未来临近时段内的云图以尽可能同步地反映近实时地面观测网络上空的宏观天气变化。传统云图预测方法的图像质量高，但准确率低，基于深度学习模型的方法能够模拟云图变化，但图像质量低。
>
> 针对这两种模型各自的优缺点，提出了一种以深度学习模型改善传统云图预测方法中运动矢量的变化性和准确率的云图预测方法。首先基于图像金字塔的迭代LK方法计算历史序列云图间的光流矢量，随后利用一个U型卷积神经网络模型拟合预测云图间光流矢量与历史云图间光流矢量的非线性关系，最后从基准图像上递归地采样重建未来预测时刻的云图。
>
> 在Himawari-8红外云图数据集中，融合方法相比于基准方法的平均SSIM值提高了0.54%，证明提出的融合算法改善了云图预测的效果。同时，通过对Himawari-8和FY-4A各类预测云图的定性分析，验证了融合算法的可用性和应用直观性。本文所提出的卫星云图预测方法综合了传统方法和深度学习模型的优点，使云图预测结果更加准确。

> 背景：
>
> 云图在气象预报中承担的作用：
>
> - 可以查看地面云层分布状态，可以实时的分析和预测云团的生消演变。（完整的云图序列，实时性）
> - 并且，不停形状和亮度的云层代表不同的天气状态，可以成为是否降水的依据，从而对强对流天气以及极端天气做出更准确的预报。（单个的云图）
>
> 云图的应用研究：
>
> - 应用研究主要是在实时的监测分析和目标识别等方面
>
> 不谈云图生产后的分析应用，目前**云图生产的问题**和**云图预测的意义**：
>
> - 接受气象卫星传来的云图存在时延，云图丢失现象，因此有必要对云图进行外推和预测。从而保证云图的连续性。
> - 如果能实现对云图移动和变化状况进行一定时效的预测，则可从一定程度上弥补实时卫星云图应用在时间上的缺陷，能够显著增强卫星云图资料在天气预报中的实用性和及时性，使卫星云图在灾害天气的预警、预报工作中发挥更大的作用
>
> **云图预测的问题**：
>
> 

### 云图预测的理论和方法

云图预测就是将过去的卫星云图序列作为输入来对未来若干时刻的卫星云图进行预测，输出预测结果[^基于3D卷积和自注意力机制的卫星云图预测研究]。这存在两个**问题**需要解决；

1. 输入的卫星云图观测区域较大，需求的生成图片也很大，这导致计算困难。
2. 大气混沌效应使得云图序列的变化规律十分复杂，云图预测模型建立十分困难。

目前人们对于云层变化（云图预测）只是依靠简单的线性外推，具体上是基于云团的匹配和追踪[^GMS卫星红外云图强对流云团的识别与追踪]，研究人员肉眼观看某个云图后，记录观察到的云团，将其结构形状用特征量表示出来，再查找后面时刻的卫星云图是否存在相似的云团，如果存在则记录该云团的空间信息，进而确定云团的移动轨迹[^**地基云图中云团的识别和短时外推方法研究**]。最后，根据大气运动的时空延续性，对目标云团进行线性外推，实现卫星云图的预测[^**卫星云图预测的运动矢量方法**][^,][^,**Short term forecasting of solar radiation based on satellite data**][^,**基于局部阈值插值的地基云自动检测方法**]。 但是，随着计算机视觉在视频插值[^A review on deep learning techniques for video prediction]、自动驾驶[^Long⁃term on⁃board prediction of people in traffic scenes under uncertainty]等时间序列预测领域的发展，这使得利用深度学习技术来提升卫星云图预测的结果成为可能 。有这些[^s]将深度学习技术运用到了卫星云图产品生成领域（或者其他分析，预测和云检测领域），这证明深度学习技术对卫星云图分析的有效性。

> #### 传统方法
>
> 基于云团的匹配和追踪确定云团的移动轨迹，最后根据大气的时空延续性对目标云团外推。
>
> 中外对于云图的预测研究工作虽然已经进行了很久，也取得了较大的研究进展，但是主要以系统保持稳定为前提条件，采用一些线性方法来基于云图局部特征匹配和前后时次云图运动矢量关系进行线性外推，在对云的发展趋势预测和预报时效上存在一定的不足，限制了这些短时效云图预测的可用度[^Shapley-模糊神经网络方法在华南台风卫星云图的长时效滚动预测中的应用j]
>
> **Shapley-模糊神经网络**此文[^Shapley-模糊神经网络方法在华南台风卫星云图的长时效滚动预测中的应用j]干了啥。没啥用。
>
> 此文[^基于时序遥感卫星云图的对流云团动态追踪预测] 提出了一种对流云团识别、跟踪和趋势预测的实时快速预测模型，该文通过模糊C均值（FCM）算法识别对流云团,然后对输出结果使用优化的近邻交叉相关法动态追踪,并根据云团运动的气旋学说,创新性的采用三次样条插值函数拟合云团运动路径。达到了较高的预测准确率和实时快速预测。
>
> 此文[^FY-4A卫星的对流云监测预报方法研究] 在追踪云方面使用”Farneback光流法“，云的外推方面使用”基于半拉格朗日“的方法。
>
> 此文[^Optical flow models as an open benchmark for radar-based precipitation nowcasting (rainymotion v0.1). Geoscientific Model Development] 用了多种光流法？？？
>
> 石玉立[^光流算法在FY-4A红外图像外推中的精度评价研究]使用稠密光流。
>
> 云的外推方面:怎么构造云团非线性预测模型
>
> - 经验正交函数分解（EOF）和遗传算法参数优化结合。
>
> - 径向基网络构建
>
>   > **问题：**但经典的组合优化算法效率低，浅层神经网络的拟合容量有限，对云团运动的模拟效果仍有改善的空间。
>
> 图像重建怎么实现？《区别一般的生成模型、超分重建概念》
>
> #### 深度学习方法
>
> 方法：采用网络模型去学习连续的图像帧之间的联系与特征信息，通过图像之间的联系性准确地输出后面的图像。核心思路是向网络中输入前N帧图像，准确生成后续的T帧。
>
> 这种时序图像预测模型大多基于自编码模型和递归神经网络。
>
> > **问题：**利用深度模型的云图预测方法虽然预测时段长，能够模拟外推云团状态变化，泛化性能显著增强，但降低了预测云图的图像质量，模糊效应明显，仍处于研究探索阶段。
>
> **自编码器能实现对图像的压缩**
>
> Xing等人[^Modeling video dynamics with deep dynencoder] 采用逐层训练的方法构建一个多层编码器模型来xxxx。Uderscu等人[^**Symbolic pregression：Discovering physical laws from distorted video**]构建卷积自编码器预测模型，但无法准确预测动作变化。Liu等人[^**Video frame synthesis using deep voxel flow**] 通过在模型中添加光流和采用卷积、反卷积结构更好的保留了空间信息。Xue et al[^**Visual dynamics：Probabilistic future frame synthesis via cross convolutional networks**]搭建基于自编码器和由卷积网络改进的预测模型，创建了条件变分自编码器，能获取未来图像的条件分布，实验证明该模型取得了不错的效果.
>
> **生成式对抗网络**
>
> 荀宇[^时序卫星云图预测算法研究] 使用GAN完成风云四号未来时刻水汽云图的预测（结合图像金字塔和样本纹理特征）
>
> 
>
> **递归神经网络有权值共享的优势**。在时间序列预测任务中可以根据当前时刻的输入数据和上一个时刻的隐藏状态得到当前时刻的预测数据，并对隐藏状态进行更新和记录，因此具有一定的记忆功能.但是对于长时间序列数据，RNN的处理效果较差，还容易出现梯度消失等**问题**。
>
> Shi et al[^**Convolutional LSTM network：A machine learning approach for precipitation nowcasting**]在LSTM的基础上提出卷积长短期记忆神经网络（Convolutional LSTM，Conv⁃LSTM）用于预测雷达回波图，取得了良好的预测结果，开启了利用RNN进行时空预测研究的新纪元.ConvLSTM通过卷积学习之前状态的空间信息，因此具备了同时提取空间特征和时间特征的能力.该方法成功地对短时雷达回波图像进行了预测，其结果比实时光流法更加准确.此后，在ConvLSTM的基础上发展了很多改进的变体结构，如Shi et al[^**Deep learning for precipitation nowcasting：A benchmark and a new model**]引入光流轨迹的思想提出轨迹门控循环单元（Trajectory GRU，Traj GRU），可以主动学习用于重复连接的位置变化结构，进一步提高了预测的准确率.
>
> 为了提高网络对时空特征的非线性拟合能力，LSTM常被堆叠使用，但对于简单的堆叠结构，时空信息分别沿时间步横向传递和沿堆叠层纵向传递，纵向传递的时空信息没有得到有效利用.因此，Wang et al[^**PredRNN：Recurrent neural networks for predictive learning using spatiotemporal LSTMs**]提出时空长短期记忆（Spatiotemporal LSTM，ST⁃LSTM），将纵向传递的信息连接到下一时间步，并使用额外的时空记忆单元对其进行更新和传递.Requena⁃Mesa et al[^**EarthNet2021：A large⁃scale dataset and challenge for Earth surface forecasting as a guided video prediction task**] 将生成对抗网络和LSTM网络结合起来预测卫星云图，效果不错.然而，标准LSTM单元仅使用一个输入门和一个遗忘门来完成输入信息的提取以及状态单元的遗忘和更新，往往只能提取输入信息中的部分信息对状态单元进行更新，因此输入信息中的部分有效信息可能会被丢失.Chang et al[^Mau：A motion⁃aware unit for video prediction and beyond]提出运动感知单元（Motion⁃Aware Unit，MAU），通过有效拓宽时间感受野来提高模型在捕捉运动信息方面的表达能力.其包含两个模块，一个关注模块和一个融合模块，实验结果证明，两个模块取得了不错的效果.Gao et al[^SimVP：Simpler yet better video prediction]提出SimVP，不使用复杂的模块，如RNN，LSTM和Transformer，也不引入复杂的训练策略，如对抗性训练和课程学习.SimVP仅需CNN、跳连和*MSE*损失，为未来的研究提供了一种新思路。
>
> 这一文章 [^基于3D卷积和自注意力机制的卫星云图预测研究]将深度学习与云图预测结合，提出了一个新的预测模型，实现了对一定一时间内的云图准确、及时的预测。其通过在LSTM中引入3D卷积和自注意力机制，双向自编码器[^Efficient and information⁃preserving future frame prediction and beyond]来更好的提起云图的时间和空间信息。



### 实验

对比算法：

| Method                                                       | <i>MAE</i>↓ | <i>MSE</i>↓ | <i>PSNR</i>↑ | <i>SSIM</i>↑ |
| ------------------------------------------------------------ | ----------- | ----------- | ------------ | ------------ |
| ConvLSTM[^**Convolutional LSTM network：A machine learning approach for precipitation nowcasting**] | 0.0528      | 0.0138      | 7.561        | 0.194        |
| PredRNN[^**PredRNN：Recurrent neural networks for predictive learning using spatiotemporal LSTMs**] | 0.0109      | 0.0127      | 14.73        | 0.259        |
| PredRNN++[^**Predrnn++：Towards a resolution of the deep⁃in⁃time dilemma in spatiotemporal predictive learning**] | 0.0135      | 0.0037      | 20.757       | 0.359        |
| Crevnet[^**Efficient and information⁃preserving future frame prediction and beyond**] | 0.0144      | 0.0008      | 27.891       | 0.461        |
| 3D  SA-STLSTM[^基于3D卷积和自注意力机制的卫星云图预测研究]   | 0.0086      | 0.0007      | 28.795       | 0.495        |

### 模型输入和输出：



```
6组历史云图间的光流图 -----------Unet----------------------> 12组未来预测光流图
图像重建
```



### 参考文献

---

[1]: 热带气象学报，1997，13(2)：63-72.
[2]: IEEETransactionsonPatternAnalysisandMachineIntelligence，2020	"A review on deep learning techniques for video prediction"
[3]: 南京大学学报	"基于3D卷积和自注意力机制的卫星云图预测研究"

